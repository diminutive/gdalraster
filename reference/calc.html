<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Raster calculation — calc • gdalraster</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Raster calculation — calc"><meta name="description" content="calc() evaluates an R expression for each pixel in a raster layer or
stack of layers. Each layer is defined by a raster filename or dataset
object, band number, and a variable name to use in the R expression. If not
specified, band defaults to 1 for each input raster. Variable names
default to LETTERS if not specified (A (layer 1), B (layer 2), ...).
All of the input layers must have the same extent and cell size.
The projection will be read from the first raster in the list of inputs.
Individual pixel coordinates are also available as variables in the
R expression, as either x/y in the raster projected coordinate system or
inverse projected longitude/latitude.
Multi-band output is supported as of gdalraster 1.11.0."><meta property="og:description" content="calc() evaluates an R expression for each pixel in a raster layer or
stack of layers. Each layer is defined by a raster filename or dataset
object, band number, and a variable name to use in the R expression. If not
specified, band defaults to 1 for each input raster. Variable names
default to LETTERS if not specified (A (layer 1), B (layer 2), ...).
All of the input layers must have the same extent and cell size.
The projection will be read from the first raster in the list of inputs.
Individual pixel coordinates are also available as variables in the
R expression, as either x/y in the raster projected coordinate system or
inverse projected longitude/latitude.
Multi-band output is supported as of gdalraster 1.11.0."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.4.0.9078</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a></li>
    <li><a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a></li>
    <li><a class="dropdown-item" href="../articles/vector-api-overview.html">Vector API Overview</a></li>
    <li><a class="dropdown-item" href="../articles/vector-read-benchmarks.html">Vector Read Benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a></li>
    <li><a class="dropdown-item" href="../articles/use-gdal-cli-from-r.html">Using 'gdal' CLI algorithms from R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Archived articles</h6></li>
    <li><a class="dropdown-item" href="../articles/gdalvector-draft.html">Draft Bindings to the GDAL/OGR Vector API</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/firelab/gdalraster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Raster calculation</h1>
      <small class="dont-index">Source: <a href="https://github.com/firelab/gdalraster/blob/main/R/gdalraster_proc.R" class="external-link"><code>R/gdalraster_proc.R</code></a></small>
      <div class="d-none name"><code>calc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>calc()</code> evaluates an <span style="R">R</span> expression for each pixel in a raster layer or
stack of layers. Each layer is defined by a raster filename or dataset
object, band number, and a variable name to use in the <span style="R">R</span> expression. If not
specified, band defaults to <code>1</code> for each input raster. Variable names
default to <code>LETTERS</code> if not specified (<code>A</code> (layer 1), <code>B</code> (layer 2), ...).
All of the input layers must have the same extent and cell size.
The projection will be read from the first raster in the list of inputs.
Individual pixel coordinates are also available as variables in the
<span style="R">R</span> expression, as either x/y in the raster projected coordinate system or
inverse projected longitude/latitude.
Multi-band output is supported as of gdalraster 1.11.0.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc</span><span class="op">(</span></span>
<span>  <span class="va">expr</span>,</span>
<span>  <span class="va">rasterfiles</span>,</span>
<span>  bands <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var.names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dstfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"rastcalc"</span>, fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>,</span>
<span>  fmt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dtName <span class="op">=</span> <span class="st">"Int16"</span>,</span>
<span>  out_band <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nodata_value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  setRasterNodataValue <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  write_mode <span class="op">=</span> <span class="st">"safe"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_obj <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>An <span style="R">R</span> expression as a character string (e.g., <code>"A + B"</code>).</p></dd>


<dt id="arg-rasterfiles">rasterfiles<a class="anchor" aria-label="anchor" href="#arg-rasterfiles"></a></dt>
<dd><p>Input rasters, either a character vector of filenames,
or a list with each element either a filename as character string or an
object of class <code>GDALRaster</code> (must be an open dataset for the latter).</p></dd>


<dt id="arg-bands">bands<a class="anchor" aria-label="anchor" href="#arg-bands"></a></dt>
<dd><p>Integer vector of band numbers to use for each raster layer.</p></dd>


<dt id="arg-var-names">var.names<a class="anchor" aria-label="anchor" href="#arg-var-names"></a></dt>
<dd><p>Character vector of variable names to use for each raster
layer.</p></dd>


<dt id="arg-dstfile">dstfile<a class="anchor" aria-label="anchor" href="#arg-dstfile"></a></dt>
<dd><p>Either a character string with the output raster filename, or
an object of class <code>GDALRaster</code> with which to write output. If given as an
object, the dataset must be open for write access, and the arguments below
related to raster creation are ignored (i.e., <code>fmt</code>, <code>dtName</code>, <code>options</code>,
<code>setRasterNodataValue</code>). The <code>write_mode</code> must be set to <code>"update"</code> for
writing with an existing dataset object.</p></dd>


<dt id="arg-fmt">fmt<a class="anchor" aria-label="anchor" href="#arg-fmt"></a></dt>
<dd><p>Output raster format name (e.g., "GTiff" or "HFA"). Will attempt
to guess from the output filename if not specified.</p></dd>


<dt id="arg-dtname">dtName<a class="anchor" aria-label="anchor" href="#arg-dtname"></a></dt>
<dd><p>Character name of output data type (e.g., Byte, Int16,
UInt16, Int32, UInt32, Float32).</p></dd>


<dt id="arg-out-band">out_band<a class="anchor" aria-label="anchor" href="#arg-out-band"></a></dt>
<dd><p>Integer band number(s) in <code>dstfile</code> for writing output.
Defaults to <code>1L</code>. Multi-band output is supported as of gdalraster 1.11.0,
in which case <code>out_band</code> would be a vector of band numbers.</p></dd>


<dt id="arg-options">options<a class="anchor" aria-label="anchor" href="#arg-options"></a></dt>
<dd><p>Optional list of format-specific creation options in a
vector of "NAME=VALUE" pairs
(e.g., <code>options = c("TILED=YES", "COMPRESS=LZW")</code> to set LZW compression
during creation of a tiled GTiff file).</p></dd>


<dt id="arg-nodata-value">nodata_value<a class="anchor" aria-label="anchor" href="#arg-nodata-value"></a></dt>
<dd><p>Numeric value to assign if <code>expr</code> returns <code>NA</code>.</p></dd>


<dt id="arg-setrasternodatavalue">setRasterNodataValue<a class="anchor" aria-label="anchor" href="#arg-setrasternodatavalue"></a></dt>
<dd><p>Logical value. <code>TRUE</code> will attempt to set the
raster format nodata value to <code>nodata_value</code>, or <code>FALSE</code> not to set a raster
nodata value on the output dataset.</p></dd>


<dt id="arg-write-mode">write_mode<a class="anchor" aria-label="anchor" href="#arg-write-mode"></a></dt>
<dd><p>Character string. Name of the file write mode for output.
One of:</p><ul><li><p><code>safe</code> - execution stops if <code>dstfile</code> already exists (no output written)</p></li>
<li><p><code>overwrite</code> - if <code>dstfile</code> exists it will be overwritten with a new file</p></li>
<li><p><code>update</code> - if <code>dstfile</code> exists, will attempt to open in update mode, or
write to the existing dataset if <code>dstfile</code> is given as an object</p></li>
</ul></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical value. If <code>TRUE</code>, a progress bar and informational
messages will not be displayed. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-return-obj">return_obj<a class="anchor" aria-label="anchor" href="#arg-return-obj"></a></dt>
<dd><p>Logical value. If <code>TRUE</code>, an object of class
<code><a href="GDALRaster-class.html">GDALRaster</a></code> opened on the newly created dataset will be
returned. The default is <code>FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments, none currently supported.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>By default, returns the output filename invisibly. An object of
class <code><a href="GDALRaster-class.html">GDALRaster</a></code> open on the output dataset will be returned
if <code>return_obj = TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The variables in <code>expr</code> are vectors of length raster xsize (i.e., row
vectors of the input raster layer(s), with length the number of raster
columns). The expression should return a vector also of length raster xsize
(an output row). Four special variable names are available in <code>expr</code>:
<code>pixelX</code> and <code>pixelY</code> provide pixel center coordinates in projection units.
<code>pixelLon</code> and <code>pixelLat</code> can also be used, in which case the pixel x/y
coordinates will be inverse projected to longitude/latitude
(in the same geographic coordinate system used by the input projection,
which is read from the first input raster). Note that inverse projection
adds computation time.</p>
<p>To refer to specific bands in a multi-band input file, repeat the filename
or dataset object in <code>rasterfiles</code> and specify corresponding band numbers in
<code>bands</code>, along with optional variable names in <code>var.names</code>, e.g.,</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">rasterfiles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"multiband.tif"</span>, <span class="st">"multiband.tif"</span><span class="op">)</span></span>
<span><span class="va">bands</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">var.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B4"</span>, <span class="st">"B5"</span><span class="op">)</span></span></code></pre></div>

<p>Output will be written to <code>dstfile</code>. To update a file that already
exists, set <code>write_mode = "update"</code> and set <code>out_band</code> to an existing
band number(s) in <code>dstfile</code> (new bands cannot be created in <code>dstfile</code>).
<code>dstfile</code> can optionally be given as an object of class <code>GDALRaster</code> open
for write access.</p>
<p>To write multi-band output, <code>expr</code> must return a vector of values
interleaved by band. This is equivalent to, and can also be returned as,
a matrix <code>m</code> with <code>nrow(m)</code> equal to <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> of an input vector, and
<code>ncol(m)</code> equal to the number of output bands. In matrix form, each column
contains a vector of output values for a band.
<code>length(m)</code> must be equal to the <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> of an input vector multiplied by
<code>length(out_band)</code>. The dimensions described above are assumed and not
read from the return value of <code>expr</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="GDALRaster-class.html">GDALRaster-class</a></code>, <code><a href="combine.html">combine()</a></code>, <code><a href="rasterToVRT.html">rasterToVRT()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Using pixel longitude/latitude</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Hopkins bioclimatic index (HI) as described in:</span></span></span>
<span class="r-in"><span><span class="co"># Bechtold, 2004, West. J. Appl. For. 19(4):245-251.</span></span></span>
<span class="r-in"><span><span class="co"># Integrates elevation, latitude and longitude into an index of the</span></span></span>
<span class="r-in"><span><span class="co"># phenological occurrence of springtime. Here it is relativized to</span></span></span>
<span class="r-in"><span><span class="co"># mean values for an eight-state region in the western US.</span></span></span>
<span class="r-in"><span><span class="co"># Positive HI means spring is delayed by that number of days relative</span></span></span>
<span class="r-in"><span><span class="co"># to the reference position, while negative values indicate spring is</span></span></span>
<span class="r-in"><span><span class="co"># advanced. The original equation had elevation units as feet, so</span></span></span>
<span class="r-in"><span><span class="co"># converting m to ft in `expr`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">elev_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storml_elev.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># expression to calculate HI</span></span></span>
<span class="r-in"><span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="st">"round( ((ELEV_M * 3.281 - 5449) / 100) +</span></span></span>
<span class="r-in"><span><span class="st">                ((pixelLat - 42.16) * 4) +</span></span></span>
<span class="r-in"><span><span class="st">                ((-116.39 - pixelLon) * 1.25) )"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calc() writes to a tempfile by default</span></span></span>
<span class="r-in"><span><span class="va">hi_file</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span>expr <span class="op">=</span> <span class="va">expr</span>,</span></span>
<span class="r-in"><span>                rasterfiles <span class="op">=</span> <span class="va">elev_file</span>,</span></span>
<span class="r-in"><span>                var.names <span class="op">=</span> <span class="st">"ELEV_M"</span>,</span></span>
<span class="r-in"><span>                dtName <span class="op">=</span> <span class="st">"Int16"</span>,</span></span>
<span class="r-in"><span>                nodata_value <span class="op">=</span> <span class="op">-</span><span class="fl">32767</span>,</span></span>
<span class="r-in"><span>                setRasterNodataValue <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> output written to /tmp/Rtmp9Vygku/rastcalc254b6eb83ade.tif</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">hi_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># min, max, mean, sd</span></span></span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">getStatistics</span><span class="op">(</span>band <span class="op">=</span> <span class="fl">1</span>, approx_ok <span class="op">=</span> <span class="cn">FALSE</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 37.000000 57.000000 44.928763  4.384622</span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate normalized difference vegetation index (NDVI)</span></span></span>
<span class="r-in"><span><span class="co">## input rasters given as dataset objects</span></span></span>
<span class="r-in"><span><span class="co">## output to an in-memory raster (MEM format)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Landast band 4 (red) and band 5 (near infrared):</span></span></span>
<span class="r-in"><span><span class="va">b4_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/sr_b4_20200829.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b4</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">b4_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b5_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/sr_b5_20200829.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b5</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">b5_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="st">"((B5 * 0.0000275 - 0.2) - (B4 * 0.0000275 - 0.2)) /</span></span></span>
<span class="r-in"><span><span class="st">         ((B5 * 0.0000275 - 0.2) + (B4 * 0.0000275 - 0.2))"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">ndvi</span> <span class="op">&lt;-</span> <span class="fu">calc</span><span class="op">(</span><span class="va">expr</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">b4</span>, <span class="va">b5</span><span class="op">)</span>, var.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B4"</span>, <span class="st">"B5"</span><span class="op">)</span>, fmt <span class="op">=</span> <span class="st">"MEM"</span>,</span></span>
<span class="r-in"><span>              dtName <span class="op">=</span> <span class="st">"Float32"</span>, setRasterNodataValue <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              return_obj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> output written to in-memory-raster</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C++ object of class GDALRaster</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Driver : In Memory Raster (MEM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  DSN    : in-memory-raster</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Dim    : 149, 112, 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  CRS    : NAD83 / UTM zone 12N (EPSG:26912)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Res    : 30.000000, 30.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Bbox   : 323400.853100, 5101815.783500, 327870.853100, 5105175.783500</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_raster.html">plot_raster</a></span><span class="op">(</span><span class="va">ndvi</span>, legend <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>            col_map_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#7b3294"</span>, <span class="st">"#c2a5cf"</span>, <span class="st">"#a6dba0"</span>, <span class="st">"#008837"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            main <span class="op">=</span> <span class="st">"Storm Lake NDVI 2020-08-29"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="calc-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ndvi</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b4</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b5</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Reclassify a variable by rule set</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine two raster layers and look for specific combinations. Then</span></span></span>
<span class="r-in"><span><span class="co"># recode to a new value by rule set.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Based on example in:</span></span></span>
<span class="r-in"><span><span class="co">#   Stratton, R.D. 2009. Guidebook on LANDFIRE fuels data acquisition,</span></span></span>
<span class="r-in"><span><span class="co">#   critique, modification, maintenance, and model calibration.</span></span></span>
<span class="r-in"><span><span class="co">#   Gen. Tech. Rep. RMRS-GTR-220. U.S. Department of Agriculture,</span></span></span>
<span class="r-in"><span><span class="co">#   Forest Service, Rocky Mountain Research Station. 54 p.</span></span></span>
<span class="r-in"><span><span class="co"># Context: Refine national-scale fuels data to improve fire simulation</span></span></span>
<span class="r-in"><span><span class="co">#   results in localized applications.</span></span></span>
<span class="r-in"><span><span class="co"># Issue: Areas with steep slopes (40+ degrees) were mapped as</span></span></span>
<span class="r-in"><span><span class="co">#   GR1 (101; short, sparse dry climate grass) and</span></span></span>
<span class="r-in"><span><span class="co">#   GR2 (102; low load, dry climate grass) but were not carrying fire.</span></span></span>
<span class="r-in"><span><span class="co"># Resolution: After viewing these areas in Google Earth,</span></span></span>
<span class="r-in"><span><span class="co">#   NB9 (99; bare ground) was selected as the replacement fuel model.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># look for combinations of slope &gt;= 40 and FBFM 101 or 102</span></span></span>
<span class="r-in"><span><span class="va">lcp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storm_lake.lcp"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rasterfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lcp_file</span>, <span class="va">lcp_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">var.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLP"</span>, <span class="st">"FBFM"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="combine.html">combine</a></span><span class="op">(</span><span class="va">rasterfiles</span>, <span class="va">var.names</span>, <span class="va">bands</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> combining 2 rasters...</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 449</span>
<span class="r-in"><span><span class="va">tbl_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">SLP</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">FBFM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">101</span>,<span class="fl">102</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl_subset</span><span class="op">)</span>       <span class="co"># twelve combinations meet the criteria</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cmbid count SLP FBFM</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     423     2  44  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    421     1  49  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13    409    15  41  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37    365     1  44  101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45    420     3  43  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 93    283    17  40  101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 160   417     4  42  101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 225   397    11  42  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 338   328    16  40  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 346   338    10  41  101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 364   418     3  47  102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 408   341     2  43  101</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tbl_subset</span><span class="op">$</span><span class="va">count</span><span class="op">)</span>   <span class="co"># 85 total pixels</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 85</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># recode these pixels to 99 (bare ground)</span></span></span>
<span class="r-in"><span><span class="co"># the LCP driver does not support in-place write so make a copy as GTiff</span></span></span>
<span class="r-in"><span><span class="va">tif_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"storml_lndscp.tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="createCopy.html">createCopy</a></span><span class="op">(</span><span class="st">"GTiff"</span>, <span class="va">tif_file</span>, <span class="va">lcp_file</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="st">"ifelse( SLP &gt;= 40 &amp; FBFM %in% c(101,102), 99, FBFM)"</span></span></span>
<span class="r-in"><span><span class="fu">calc</span><span class="op">(</span>expr <span class="op">=</span> <span class="va">expr</span>,</span></span>
<span class="r-in"><span>     rasterfiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lcp_file</span>, <span class="va">lcp_file</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     var.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLP"</span>, <span class="st">"FBFM"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     dstfile <span class="op">=</span> <span class="va">tif_file</span>,</span></span>
<span class="r-in"><span>     out_band <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>     write_mode <span class="op">=</span> <span class="st">"update"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> output written to /tmp/Rtmp9Vygku/storml_lndscp.tif</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># verify the ouput</span></span></span>
<span class="r-in"><span><span class="va">rasterfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tif_file</span>, <span class="va">tif_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="combine.html">combine</a></span><span class="op">(</span><span class="va">rasterfiles</span>, <span class="va">var.names</span>, <span class="va">bands</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> combining 2 rasters...</span>
<span class="r-in"><span><span class="va">tbl_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">SLP</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">FBFM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">101</span>,<span class="fl">102</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl_subset</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] cmbid count SLP   FBFM </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;0 rows&gt; (or 0-length row.names)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tbl_subset</span><span class="op">$</span><span class="va">count</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if LCP file format is needed:</span></span></span>
<span class="r-in"><span><span class="co"># createCopy("LCP", "storml_edited.lcp", tif_file)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chris Toney, Michael D. Sumner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

